---
# tasks file for dot

- name: Gather facts.
  ansible.builtin.setup:
    gather_subset:
      - min

- name: Install dotbashprofiles if shell is bash.
  ansible.builtin.template:
    src: "{{ playbook_dir }}/.{{ dot_item }}"
    dest: "{{ ansible_facts['user_dir'] }}/.{{ dot_item }}"
    mode: u=rw,g=r,o=r
    backup: true
  when: ansible_facts['user_shell'] is ansible.builtin.search('bash')
  loop: "{{ __dot_bash_profiles }}"
  loop_control:
    loop_var: dot_item

- name: Ensure directory for tmux is present.
  ansible.builtin.file:
    path: "{{ ansible_facts['user_dir'] }}/.config/tmux"
    mode: u=xrw,g=xr,o=x
    state: directory

- name: Install configuration for tmux.
  ansible.builtin.template:
    src: "{{ playbook_dir }}/.config/tmux/tmux.conf"
    dest: "{{ ansible_facts['user_dir'] }}/.config/tmux/tmux.conf"
    mode: u=rw,g=r,o=r
    backup: true

- name: Ensure directories for nvim are present.
  ansible.builtin.file:
    path: "{{ dot_item }}"
    state: directory
    mode: u=xrw,g=xr,o=x
  loop: "{{ __dot_nvim_directories }}"
  loop_control:
    loop_var: dot_item

- name: Install configuration files for nvim.
  ansible.builtin.copy:
    src: "{{ dot_item['src'] }}"
    dest: "{{ dot_item['dest'] }}"
    mode: u=rw,g=r,o=r
    backup: true
  loop: "{{ dot_nvim_files }}"
  loop_control:
    loop_var: dot_item
    label: "{{ dot_item['dest'] }}"

- name: Install plugins for nvim.
  ansible.builtin.git:
    repo: "{{ dot_item['repo'] }}"
    dest: "{{ dot_item['dest'] }}"
    depth: 1
    update: true
    force: true
    version: "{{ dot_item['version'] }}"
  loop: "{{ dot_nvim_plugins }}"
  loop_control:
    loop_var: dot_item
    label: "{{ dot_item['repo'] }}"
